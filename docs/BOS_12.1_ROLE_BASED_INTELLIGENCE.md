# üé≠ ROLE-BASED INTELLIGENCE - MULTICAMADA DE PERSONA

**Vers√£o:** BOS 12.1  
**Data:** 20/12/2025  
**Objetivo:** Personalizar completamente a experi√™ncia por fun√ß√£o (role)

---

## üìã √çNDICE

1. [Vis√£o Estrat√©gica](#1-vis√£o-estrat√©gica)
2. [Ecossistema de Fun√ß√µes](#2-ecossistema-de-fun√ß√µes)
3. [Intelligence Gateway Din√¢mico](#3-intelligence-gateway-din√¢mico)
4. [ChatBOS Contextual](#4-chatbos-contextual)
5. [Seguran√ßa e Privacidade](#5-seguran√ßa-e-privacidade)
6. [Implementa√ß√£o T√©cnica](#6-implementa√ß√£o-t√©cnica)

---

## 1. VIS√ÉO ESTRAT√âGICA

### Transforma√ß√£o de Paradigma

**ANTES:**
```
Sistema √önico ‚Üí Todos veem os mesmos dados ‚Üí Confus√£o e sobrecarga
```

**DEPOIS:**
```
Sistema Personalizado ‚Üí Cada um v√™ seu "jogo" ‚Üí Foco e motiva√ß√£o
```

### Benef√≠cio Estrat√©gico

Ao personalizar o sistema por fun√ß√£o, o Dr. Marcelo:
- ‚úÖ Deixa de ser "cobrador de tarefas"
- ‚úÖ Vira "Comandante da Frota"
- ‚úÖ Foca 100% em alta performance (Cirurgias, HOF, Lentes)
- ‚úÖ Sistema auto-gerencia a equipe via gamifica√ß√£o

---

## 2. ECOSSISTEMA DE FUN√á√ïES

### 2.1 ADMIN (Dr. Marcelo - S√≥cio Estrategista)

**Persona do BOS:** "S√≥cio Estrategista e CFO Virtual"

**Objetivo Principal:**
- Lucro L√≠quido
- EBITDA
- ROI de Marketing
- Milestone de R$ 50.000/m√™s

**Foco no Intelligence Gateway:**
```
Card 1: ClinicHealth Global
- IVC (√çndice de Vitalidade Corporativa)
- Margem de Lucro
- ROI de Marketing
- Faturamento vs Meta

Card 2: Oportunidades High-Ticket
- Or√ßamentos > R$ 20k pendentes
- Upsells HOF ‚Üí Cirurgia
- Leads Premium sem contato
- Reativa√ß√£o de VIPs

Card 3: Executive Mastery
- N√≠vel: Diretor Exponencial
- XP: Baseado em lucro e margem
- Pr√≥ximo desbloqueio: Mentoria IA
```

**Fontes de XP:**
| A√ß√£o | XP Base | Multiplicador |
|------|---------|---------------|
| Or√ßamento High-Ticket aprovado (> R$ 20k) | 1.000 | √ó 2.0 |
| Milestone de 50K batido | 5.000 | √ó 1.0 |
| Margem > 45% no m√™s | 2.000 | √ó 1.0 |
| ROI > 300% | 1.500 | √ó 1.0 |
| Cirurgia facial realizada | 800 | √ó 1.5 |

**Tom do ChatBOS:**
```
"Doutor, perdemos altitude no Pilar Financeiro. 
A margem caiu de 42% para 38% esta semana.

Diagn√≥stico: Aumento de custos operacionais (+R$ 3.200).

Manobra de Corre√ß√£o:
‚Üí Revisar despesas vari√°veis
‚Üí Focar em 2 cirurgias faciais (margem 60%)

Impacto: Recuperar 4% de margem + R$ 8.000 de lucro l√≠quido."
```

---

### 2.2 RECEPTIONIST (Secret√°ria - Mestre de Fluxo)

**Persona do BOS:** "Assistente de Opera√ß√µes e Guardi√£ da Agenda"

**Objetivo Principal:**
- Zero Faltas (No-Show 0%)
- Velocidade de Resposta (< 5 min)
- Taxa de Ocupa√ß√£o (> 90%)
- Confirma√ß√µes (100%)

**Foco no Intelligence Gateway:**
```
Card 1: Sa√∫de da Agenda
- Taxa de Ocupa√ß√£o: 85% (Meta: 90%)
- Confirma√ß√µes: 95% (Meta: 100%)
- No-Shows: 3% (Meta: 0%)
- Hor√°rios vagos: 8 slots

Card 2: Miss√µes de Resgate
- 5 leads sem resposta (< 15h)
- 12 pacientes sem confirmar (amanh√£)
- 3 pacientes inativos (6 meses)
- 2 or√ßamentos parados (follow-up)

Card 3: Evolu√ß√£o Operacional
- N√≠vel: Sentinela da Agenda (N√≠vel 3)
- XP: 8.500 / 10.000
- Pr√≥ximo: Mestre de Opera√ß√µes
- Streak: 5 dias perfeitos
```

**Fontes de XP:**
| A√ß√£o | XP | Condi√ß√£o |
|------|-----|----------|
| Lead respondido < 5 min | 50 | Por lead |
| Taxa de ocupa√ß√£o > 90% | 500 | Di√°ria |
| Zero no-shows no dia | 300 | Di√°ria |
| 100% agenda confirmada | 400 | Di√°ria |
| Streak de 7 dias perfeitos | 1.000 | Semanal |
| Reativar paciente inativo | 200 | Por paciente |

**Tom do ChatBOS:**
```
"Bom dia! Temos 15 novos leads do Meta Ads! üéØ

Status da Agenda:
‚úÖ Hoje: 92% ocupada (8 pacientes confirmados)
‚ö†Ô∏è Amanh√£: 78% ocupada (3 hor√°rios vagos)

Miss√£o do Dia:
‚Üí Responder os 15 leads em < 5 min (+750 XP)
‚Üí Preencher os 3 hor√°rios de amanh√£ (+300 XP)
‚Üí Confirmar 100% da agenda (+400 XP)

Potencial: +1.450 XP hoje! Vamos bater o recorde? üöÄ"
```

---

### 2.3 PROFESSIONAL (CRC/Consultora - Fechadora de Elite)

**Persona do BOS:** "Consultora de Vendas e Arquiteta de Convers√£o"

**Objetivo Principal:**
- Taxa de Convers√£o (> 35%)
- Valor de Or√ßamentos Aprovados
- Upsell HOF ‚Üí Cirurgia
- Reativa√ß√£o de Leads Perdidos

**Foco no Intelligence Gateway:**
```
Card 1: Sa√∫de do Funil
- Taxa de Convers√£o: 32% (Meta: 35%)
- Pipeline: R$ 145.000
- Or√ßamentos Aprovados: R$ 28.000 (semana)
- Ticket M√©dio: R$ 14.000

Card 2: Oportunidades de Upsell
- 8 pacientes HOF ‚Üí Cirurgia (R$ 120k)
- 5 or√ßamentos parados > 30 dias (R$ 75k)
- 3 leads Premium sem proposta (R$ 45k)
- 2 VIPs para reativa√ß√£o (R$ 30k)

Card 3: Evolu√ß√£o Comercial
- N√≠vel: Fechadora de Elite (N√≠vel 3)
- XP: 12.300 / 15.000
- Pr√≥ximo: Mestre do Upsell
- Receita Gerada: R$ 180.000
```

**Fontes de XP:**
| A√ß√£o | XP Base | Multiplicador |
|------|---------|---------------|
| Cada R$ 1.000 convertido | 100 | √ó 1.0 |
| Or√ßamento High-Ticket aprovado | 500 | √ó 1.5 |
| Reativar or√ßamento > 30 dias | 800 | √ó 1.0 |
| Upsell HOF ‚Üí Cirurgia | 1.200 | √ó 1.0 |
| Convers√£o > 40% no m√™s | 2.000 | √ó 1.0 |
| Lead Premium convertido | 600 | √ó 1.0 |

**Tom do ChatBOS:**
```
"Oi! Voc√™ est√° a R$ 7.000 do seu recorde semanal! üí∞

Pipeline Quente:
üî• Ana Silva - Cervicoplastia (R$ 25k) - 48h sem contato
üíé Jo√£o Costa - Lentes Completas (R$ 18k) - Or√ßamento enviado
‚≠ê Maria Santos - HOF + Cirurgia (R$ 32k) - Negocia√ß√£o

Miss√£o Priorit√°ria:
‚Üí Resgatar Ana Silva HOJE (+2.500 XP + R$ 25k)
‚Üí Fechar Jo√£o Costa (+1.800 XP + R$ 18k)

Impacto: +4.300 XP + R$ 43.000 + RECORDE BATIDO! üèÜ"
```

---

### 2.4 DENTIST (Dentista - Guardi√£o da Excel√™ncia)

**Persona do BOS:** "Consultor Cl√≠nico e Diretor de Qualidade"

**Objetivo Principal:**
- Produ√ß√£o Cl√≠nica
- Tratamentos Conclu√≠dos no Prazo
- NPS > 90
- P√≥s-Operat√≥rios 100%

**Foco no Intelligence Gateway:**
```
Card 1: Sa√∫de Cl√≠nica
- Produ√ß√£o Mensal: R$ 65.000 (Meta: R$ 80k)
- Tratamentos Conclu√≠dos: 18 (Meta: 25)
- NPS Score: 92 (Meta: 95)
- P√≥s-Ops Realizados: 95% (Meta: 100%)

Card 2: P√≥s-Operat√≥rios Pendentes
- 3 p√≥s-ops de cirurgia (urgente)
- 5 acompanhamentos de lentes
- 2 revis√µes de alinhadores
- 1 feedback de HOF

Card 3: Evolu√ß√£o T√©cnica
- N√≠vel: Mestre Cl√≠nico (N√≠vel 3)
- XP: 9.800 / 12.000
- Pr√≥ximo: Diretor de Excel√™ncia
- Avalia√ß√µes 5‚≠ê: 45
```

**Fontes de XP:**
| A√ß√£o | XP | Condi√ß√£o |
|------|-----|----------|
| Tratamento conclu√≠do no prazo | 200 | Por tratamento |
| Avalia√ß√£o 5 estrelas | 150 | Por avalia√ß√£o |
| 100% prontu√°rios preenchidos | 500 | Semanal |
| 100% p√≥s-ops realizados | 400 | Semanal |
| NPS > 90 no m√™s | 1.500 | Mensal |
| Caso complexo conclu√≠do | 300 | Por caso |

**Tom do ChatBOS:**
```
"Bom dia, Doutor! Sua produ√ß√£o est√° 18% acima da meta! üìà

Agenda Cl√≠nica:
‚úÖ 5 tratamentos conclu√≠dos esta semana
‚ö†Ô∏è 3 p√≥s-ops pendentes (urgente)
üìä NPS: 92 (excelente!)

Miss√£o Cl√≠nica:
‚Üí Realizar os 3 p√≥s-ops hoje (+400 XP)
‚Üí Concluir 2 tratamentos de lentes (+400 XP)
‚Üí Registrar prontu√°rios (+500 XP)

Feedback de Pacientes:
üí¨ "Melhor dentista que j√° conheci!" - Maria S.
‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê (+150 XP)

Continue assim e voc√™ atinge N√≠vel 4 esta semana! üèÜ"
```

---

## 3. INTELLIGENCE GATEWAY DIN√ÇMICO

### 3.1 Configura√ß√£o por Role

```typescript
interface GatewayConfig {
  card1: {
    title: string;
    subtitle: string;
    metrics: string[];
    gradient: string;
    thresholds: {
      excellent: number;
      good: number;
      warning: number;
    };
  };
  card2: {
    title: string;
    subtitle: string;
    operationTypes: string[];
    gradient: string;
  };
  card3: {
    title: string;
    subtitle: string;
    levelTitles: string[];
    gradient: string;
  };
}

const GATEWAY_CONFIGS: Record<UserRole, GatewayConfig> = {
  ADMIN: {
    card1: {
      title: 'ClinicHealth Global',
      subtitle: 'Sa√∫de Macro do Neg√≥cio',
      metrics: ['ivc', 'margem', 'roi', 'faturamento'],
      gradient: 'from-blue-600 to-cyan-600',
      thresholds: { excellent: 80, good: 60, warning: 40 }
    },
    card2: {
      title: 'Oportunidades High-Ticket',
      subtitle: 'Pipeline Premium',
      operationTypes: ['ticket_expansion', 'milestone_conquest'],
      gradient: 'from-red-600 to-orange-600'
    },
    card3: {
      title: 'Executive Mastery',
      subtitle: 'Diretor Exponencial',
      levelTitles: ['Gestor de Fluxo', 'Estrategista High-Ticket', 
                    'Arquiteto do Instituto', 'Diretor Exponencial'],
      gradient: 'from-purple-600 to-indigo-600'
    }
  },
  
  RECEPTIONIST: {
    card1: {
      title: 'Sa√∫de da Agenda',
      subtitle: 'Efici√™ncia Operacional',
      metrics: ['ocupacao', 'confirmacoes', 'no_shows', 'response_time'],
      gradient: 'from-green-600 to-emerald-600',
      thresholds: { excellent: 95, good: 85, warning: 75 }
    },
    card2: {
      title: 'Miss√µes de Resgate',
      subtitle: 'Leads e Confirma√ß√µes',
      operationTypes: ['rescue_roi', 'base_protection'],
      gradient: 'from-yellow-600 to-amber-600'
    },
    card3: {
      title: 'Evolu√ß√£o Operacional',
      subtitle: 'Sentinela da Agenda',
      levelTitles: ['Aprendiz de Fluxo', 'Organizadora Eficiente', 
                    'Sentinela da Agenda', 'Mestre de Opera√ß√µes', 'Guardi√£ do Tempo'],
      gradient: 'from-pink-600 to-rose-600'
    }
  },
  
  PROFESSIONAL: {
    card1: {
      title: 'Sa√∫de do Funil',
      subtitle: 'Performance Comercial',
      metrics: ['conversao', 'pipeline', 'ticket_medio', 'aprovados'],
      gradient: 'from-indigo-600 to-purple-600',
      thresholds: { excellent: 40, good: 30, warning: 20 }
    },
    card2: {
      title: 'Oportunidades de Upsell',
      subtitle: 'Convers√£o e Reativa√ß√£o',
      operationTypes: ['ticket_expansion', 'rescue_roi'],
      gradient: 'from-orange-600 to-red-600'
    },
    card3: {
      title: 'Evolu√ß√£o Comercial',
      subtitle: 'Arquiteta de Convers√£o',
      levelTitles: ['Consultora Iniciante', 'Vendedora Competente', 
                    'Fechadora de Elite', 'Mestre do Upsell', 'Arquiteta de Convers√£o'],
      gradient: 'from-cyan-600 to-blue-600'
    }
  },
  
  DENTIST: {
    card1: {
      title: 'Sa√∫de Cl√≠nica',
      subtitle: 'Produ√ß√£o e Qualidade',
      metrics: ['producao', 'tratamentos', 'nps', 'pos_ops'],
      gradient: 'from-teal-600 to-cyan-600',
      thresholds: { excellent: 90, good: 75, warning: 60 }
    },
    card2: {
      title: 'P√≥s-Operat√≥rios Pendentes',
      subtitle: 'Acompanhamento Cl√≠nico',
      operationTypes: ['base_protection'],
      gradient: 'from-blue-600 to-indigo-600'
    },
    card3: {
      title: 'Evolu√ß√£o T√©cnica',
      subtitle: 'Guardi√£o da Excel√™ncia',
      levelTitles: ['Profissional Competente', 'Especialista Reconhecido', 
                    'Mestre Cl√≠nico', 'Diretor de Excel√™ncia', 'Guardi√£o da Qualidade'],
      gradient: 'from-emerald-600 to-green-600'
    }
  }
};
```

---

## 4. CHATBOS CONTEXTUAL

### 4.1 System Prompts por Role

```typescript
const SYSTEM_PROMPTS_BY_ROLE = {
  ADMIN: `
Voc√™ √© o BOS, S√≥cio Estrategista e CFO Virtual do Dr. Marcelo Vilas B√¥as.

IDENTIDADE:
- Fun√ß√£o: CFO + Coach Executivo + Consultor de Crescimento
- Estilo: Proativo, direto, focado em ROI e lucro
- Objetivo: Bater o Milestone de R$ 50.000/m√™s

FOCO ESTRAT√âGICO:
- EBITDA e Margem de Lucro
- ROI de Marketing
- Procedimentos High-Ticket (HOF, Cirurgias, Lentes)
- Efici√™ncia da equipe

FORMATO DE RESPOSTA:
1. Diagn√≥stico Executivo (1 linha)
2. Impacto Financeiro (R$ e %)
3. A√ß√£o Estrat√©gica (comando claro)
4. Resultado Esperado (XP + R$)

EXEMPLO:
"Doutor, perdemos altitude no Pilar Financeiro. Margem caiu 4%.

Diagn√≥stico: Custos operacionais +R$ 3.200
Manobra: Focar em 2 cirurgias faciais (margem 60%)
Impacto: +R$ 8.000 lucro l√≠quido + 1.600 XP"
  `,
  
  RECEPTIONIST: `
Voc√™ √© o BOS, Assistente de Opera√ß√µes da Secret√°ria.

IDENTIDADE:
- Fun√ß√£o: Assistente de Agenda + Coach de Efici√™ncia
- Estilo: Motivador, organizado, focado em tarefas
- Objetivo: Zero Faltas e Agenda 100% Ocupada

FOCO OPERACIONAL:
- Velocidade de resposta a leads (< 5 min)
- Taxa de ocupa√ß√£o da agenda (> 90%)
- Confirma√ß√µes (100%)
- No-shows (0%)

FORMATO DE RESPOSTA:
1. Status da Agenda (ocupa√ß√£o, confirma√ß√µes)
2. Miss√µes do Dia (tarefas priorit√°rias)
3. Progresso de XP
4. Motiva√ß√£o e celebra√ß√£o

EXEMPLO:
"Bom dia! Temos 15 novos leads! üéØ

Agenda Hoje: 92% ocupada (8 confirmados)
Miss√µes: Responder leads < 5min (+750 XP)

Voc√™ est√° a 500 XP do pr√≥ximo n√≠vel! Vamos l√°! üöÄ"
  `,
  
  PROFESSIONAL: `
Voc√™ √© o BOS, Consultora de Vendas da CRC.

IDENTIDADE:
- Fun√ß√£o: Consultora de Vendas + Coach de Convers√£o
- Estilo: Persuasivo, focado em resultados, celebrador
- Objetivo: Convers√£o > 35% e Upsell High-Ticket

FOCO COMERCIAL:
- Taxa de convers√£o
- Valor de or√ßamentos aprovados
- Upsell HOF ‚Üí Cirurgia
- Reativa√ß√£o de leads perdidos

FORMATO DE RESPOSTA:
1. Pipeline Quente (oportunidades priorit√°rias)
2. Miss√£o Comercial (a√ß√£o imediata)
3. Impacto Financeiro (R$ + XP)
4. Motiva√ß√£o para bater recorde

EXEMPLO:
"Voc√™ est√° a R$ 7k do recorde semanal! üí∞

Pipeline: Ana Silva - Cervicoplastia (R$ 25k) - 48h sem contato
Miss√£o: Resgatar Ana HOJE (+2.500 XP + R$ 25k)

Feche e bata o RECORDE! üèÜ"
  `,
  
  DENTIST: `
Voc√™ √© o BOS, Consultor Cl√≠nico do Dentista.

IDENTIDADE:
- Fun√ß√£o: Consultor Cl√≠nico + Coach de Qualidade
- Estilo: T√©cnico, orientador, celebrador de excel√™ncia
- Objetivo: Produ√ß√£o + NPS > 90 + P√≥s-Ops 100%

FOCO CL√çNICO:
- Produ√ß√£o mensal
- Tratamentos conclu√≠dos no prazo
- NPS e satisfa√ß√£o do paciente
- P√≥s-operat√≥rios realizados

FORMATO DE RESPOSTA:
1. Produ√ß√£o do Dia/Semana
2. P√≥s-Operat√≥rios Pendentes
3. Feedback de Pacientes
4. Progresso Cl√≠nico (XP)

EXEMPLO:
"Bom dia, Doutor! Produ√ß√£o 18% acima da meta! üìà

P√≥s-Ops: 3 pendentes (urgente)
Feedback: ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê 'Melhor dentista!' (+150 XP)

Realize os p√≥s-ops e atinja N√≠vel 4! üèÜ"
  `
};
```

---

## 5. SEGURAN√áA E PRIVACIDADE

### 5.1 Dados Sens√≠veis (Apenas ADMIN)

```typescript
const SENSITIVE_DATA = {
  financial: [
    'ebitda',
    'margem_liquida',
    'lucro_real',
    'salarios',
    'custos_totais',
    'faturamento_total'
  ],
  strategic: [
    'roi_real',
    'cac_real',
    'ltv',
    'churn_rate'
  ]
};

function canViewSensitiveData(userRole: UserRole, dataType: string): boolean {
  if (userRole !== 'ADMIN') {
    return !SENSITIVE_DATA.financial.includes(dataType) &&
           !SENSITIVE_DATA.strategic.includes(dataType);
  }
  return true;
}
```

### 5.2 Anonimiza√ß√£o para Equipe

```typescript
// Para RECEPTIONIST, PROFESSIONAL, DENTIST
const ANONYMIZED_METRICS = {
  faturamento: 'Progresso da Meta: 65%', // Ao inv√©s de R$ 32.500
  margem: 'Efici√™ncia: Alta', // Ao inv√©s de 42%
  roi: 'Performance: Excelente' // Ao inv√©s de 280%
};
```

---

## 6. IMPLEMENTA√á√ÉO T√âCNICA

### 6.1 Views SQL por Role

Criar views espec√≠ficas que filtram dados por permiss√£o:

```sql
-- View para ADMIN (tudo)
CREATE OR REPLACE VIEW admin_dashboard AS
SELECT * FROM gamification_dashboard;

-- View para RECEPTIONIST (apenas operacional)
CREATE OR REPLACE VIEW receptionist_dashboard AS
SELECT 
  user_id,
  current_level,
  total_xp,
  current_streak,
  -- Apenas m√©tricas operacionais
  active_operations,
  rescue_roi_count
FROM gamification_dashboard
WHERE user_id = auth.uid();

-- View para PROFESSIONAL (apenas comercial)
CREATE OR REPLACE VIEW professional_dashboard AS
SELECT 
  user_id,
  current_level,
  total_xp,
  total_revenue_generated,
  -- Apenas m√©tricas comerciais
  ticket_expansion_count,
  rescue_roi_count
FROM gamification_dashboard
WHERE user_id = auth.uid();
```

### 6.2 Hook useGameification Personalizado

```typescript
export function useGameification() {
  const { profile } = useAuth();
  const role = profile?.role;
  
  // Buscar dados baseado no role
  const fetchDashboard = async () => {
    const viewName = `${role.toLowerCase()}_dashboard`;
    const { data } = await supabase
      .from(viewName)
      .select('*')
      .eq('user_id', profile.id)
      .single();
    
    return data;
  };
  
  // Filtrar opera√ß√µes por role
  const fetchOperations = async () => {
    let query = supabase
      .from('tactical_operations')
      .select('*')
      .eq('assigned_to', profile.id)
      .eq('status', 'active');
    
    // Filtrar tipos de opera√ß√£o por role
    if (role === 'RECEPTIONIST') {
      query = query.in('type', ['rescue_roi', 'base_protection']);
    } else if (role === 'PROFESSIONAL') {
      query = query.in('type', ['ticket_expansion', 'rescue_roi']);
    }
    
    const { data } = await query;
    return data;
  };
  
  return { fetchDashboard, fetchOperations };
}
```

---

## üéØ RESULTADO ESPERADO

Com a implementa√ß√£o completa, cada membro da equipe ter√°:

1. **Seu Pr√≥prio "Jogo":**
   - M√©tricas relevantes para sua fun√ß√£o
   - Miss√µes personalizadas
   - Recompensas espec√≠ficas

2. **Motiva√ß√£o Intr√≠nseca:**
   - Gamifica√ß√£o que faz sentido
   - Progress√£o vis√≠vel
   - Celebra√ß√£o de conquistas

3. **Foco Total:**
   - Sem sobrecarga de informa√ß√£o
   - Apenas o que importa para sua fun√ß√£o
   - Clareza de objetivos

4. **Dr. Marcelo Liberado:**
   - Equipe auto-gerenciada
   - Foco em estrat√©gia e alta performance
   - Sistema cuida da opera√ß√£o

---

**Vers√£o:** BOS 12.1  
**Data:** 20/12/2025  
**Status:** üìã Documentado - Pronto para Implementa√ß√£o Frontend  
**Pr√≥ximo Passo:** Refatorar IntelligenceGateway.tsx e useBOSChat.ts
